{"version":3,"file":"crypto-DgWI3rvl.js","sources":["../../../shared/src/crypto/crypto-engine.ts","../../src/lib/crypto.ts"],"sourcesContent":["/**\n * AnyNote æ ¸å¿ƒåŠ å¯†å¼•æ“\n *\n * å®‰å…¨è§„èŒƒï¼š\n * - åŠ å¯†ç®—æ³•ï¼šAES-256-GCM\n * - å¯†é’¥æ´¾ç”Ÿï¼šPBKDF2-SHA256ï¼ˆ600,000 è¿­ä»£ï¼‰\n * - é›¶çŸ¥è¯†æ¶æ„ï¼šä¸»å¯†ç æ°¸ä¸ä¸Šä¼ æœåŠ¡å™¨\n *\n * å¨èƒæ¨¡å‹ï¼š\n * - é˜²å¾¡æœåŠ¡å™¨æ”»ç ´ï¼šç«¯åˆ°ç«¯åŠ å¯†ï¼ŒæœåŠ¡å™¨æ— è§£å¯†èƒ½åŠ›\n * - é˜²å¾¡æš´åŠ›ç ´è§£ï¼šé«˜è¿­ä»£ PBKDF2 + å¼ºå¯†ç ç­–ç•¥\n * - é˜²å¾¡æ—¶åºæ”»å‡»ï¼šå¸¸é‡æ—¶é—´æ¯”è¾ƒ\n *\n * @module crypto-engine\n */\n\nconst PBKDF2_ITERATIONS = 600_000; // OWASP 2025 æ¨è\nconst AES_KEY_LENGTH = 256;\nconst GCM_IV_LENGTH = 12; // GCM æ¨è 12 å­—èŠ‚\nconst GCM_TAG_LENGTH = 128; // è®¤è¯æ ‡ç­¾é•¿åº¦ï¼ˆä½ï¼‰\n\nexport interface EncryptedPayload {\n  ciphertext: string;  // Hex ç¼–ç çš„å¯†æ–‡\n  iv: string;          // Hex ç¼–ç çš„ IV/Nonce\n  algorithm: string;   // åŠ å¯†ç®—æ³•æ ‡è¯†\n}\n\nexport interface DerivedKeys {\n  encryptionKey: CryptoKey;  // ç”¨äºåŠ å¯†æ•°æ®\n  authHash: string;          // ç”¨äºæœåŠ¡ç«¯èº«ä»½éªŒè¯ï¼ˆHex ç¼–ç ï¼‰\n}\n\n/**\n * æ ¸å¿ƒåŠ å¯†å¼•æ“ç±»\n */\nexport class CryptoEngine {\n  /**\n   * æ´¾ç”Ÿä¸»å¯†é’¥å’Œè®¤è¯å¯†é’¥\n   *\n   * @param masterPassword ç”¨æˆ·ä¸»å¯†ç \n   * @param email ç”¨æˆ·é‚®ç®±ï¼ˆä½œä¸ºç›çš„ä¸€éƒ¨åˆ†ï¼‰\n   * @param salt éšæœºç›ï¼ˆHex ç¼–ç ï¼Œæ³¨å†Œæ—¶ç”Ÿæˆï¼Œç™»å½•æ—¶ä»æœåŠ¡å™¨è·å–ï¼‰\n   * @returns æ´¾ç”Ÿçš„åŠ å¯†å¯†é’¥å’Œè®¤è¯å“ˆå¸Œ\n   */\n  static async deriveKeys(\n    masterPassword: string,\n    email: string,\n    salt: string\n  ): Promise<DerivedKeys> {\n    // æ­¥éª¤ 1ï¼šå°†ä¸»å¯†ç è½¬æ¢ä¸º CryptoKey\n    const passwordKey = await crypto.subtle.importKey(\n      'raw',\n      new TextEncoder().encode(masterPassword),\n      'PBKDF2',\n      false,\n      ['deriveKey', 'deriveBits']\n    );\n\n    // æ­¥éª¤ 2ï¼šç»“åˆ email å’Œéšæœºç›ç”Ÿæˆå”¯ä¸€ç›å€¼\n    const combinedSalt = new TextEncoder().encode(`${email}:${salt}`);\n\n    // æ­¥éª¤ 3ï¼šæ´¾ç”ŸåŠ å¯†å¯†é’¥ï¼ˆç”¨äºåŠ å¯†æ•°æ®ï¼‰\n    const encryptionKey = await crypto.subtle.deriveKey(\n      {\n        name: 'PBKDF2',\n        salt: combinedSalt,\n        iterations: PBKDF2_ITERATIONS,\n        hash: 'SHA-256',\n      },\n      passwordKey,\n      { name: 'AES-GCM', length: AES_KEY_LENGTH },\n      true, // å¯å¯¼å‡ºï¼ˆå…è®¸ä½¿ç”¨ wrapKey åŒ…è£…åæŒä¹…åŒ–åˆ° IndexedDBï¼‰\n      ['encrypt', 'decrypt']\n    );\n\n    // æ­¥éª¤ 4ï¼šæ´¾ç”Ÿè®¤è¯å¯†é’¥ï¼ˆç”¨äºæœåŠ¡ç«¯éªŒè¯ï¼Œè¾ƒä½è¿­ä»£ï¼‰\n    const authSalt = new TextEncoder().encode(`auth:${email}:${salt}`);\n    const authBits = await crypto.subtle.deriveBits(\n      {\n        name: 'PBKDF2',\n        salt: authSalt,\n        iterations: 100_000, // è¾ƒä½è¿­ä»£ï¼ˆä»…ç”¨äºè®¤è¯ï¼‰\n        hash: 'SHA-256',\n      },\n      passwordKey,\n      256\n    );\n\n    // å°†è®¤è¯å¯†é’¥è½¬æ¢ä¸º Hex å­—ç¬¦ä¸²\n    const authHash = Array.from(new Uint8Array(authBits))\n      .map((b) => b.toString(16).padStart(2, '0'))\n      .join('');\n\n    return {\n      encryptionKey,\n      authHash,\n    };\n  }\n\n  /**\n   * åŠ å¯†æ•°æ®ï¼ˆAES-256-GCMï¼‰\n   *\n   * @param plaintext æ˜æ–‡æ•°æ®ï¼ˆä»»æ„ç±»å‹ï¼Œä¼šè‡ªåŠ¨åºåˆ—åŒ–ï¼‰\n   * @param encryptionKey åŠ å¯†å¯†é’¥\n   * @returns åŠ å¯†åçš„æ•°æ®åŒ…ï¼ˆåŒ…å«å¯†æ–‡å’Œ IVï¼‰\n   */\n  static async encrypt(\n    plaintext: any,\n    encryptionKey: CryptoKey\n  ): Promise<EncryptedPayload> {\n    // æ­¥éª¤ 1ï¼šåºåˆ—åŒ–æ•°æ®\n    const plaintextString = typeof plaintext === 'string'\n      ? plaintext\n      : JSON.stringify(plaintext);\n    const plaintextBuffer = new TextEncoder().encode(plaintextString);\n\n    // æ­¥éª¤ 2ï¼šç”Ÿæˆéšæœº IVï¼ˆæ¯æ¬¡åŠ å¯†éƒ½å¿…é¡»ä¸åŒï¼‰\n    const iv = crypto.getRandomValues(new Uint8Array(GCM_IV_LENGTH));\n\n    // æ­¥éª¤ 3ï¼šä½¿ç”¨ AES-GCM åŠ å¯†\n    const ciphertextBuffer = await crypto.subtle.encrypt(\n      {\n        name: 'AES-GCM',\n        iv: iv,\n        tagLength: GCM_TAG_LENGTH,\n      },\n      encryptionKey,\n      plaintextBuffer\n    );\n\n    // æ­¥éª¤ 4ï¼šè½¬æ¢ä¸º Hex ç¼–ç ï¼ˆä¾¿äºå­˜å‚¨å’Œä¼ è¾“ï¼‰\n    const ciphertext = Array.from(new Uint8Array(ciphertextBuffer))\n      .map((b) => b.toString(16).padStart(2, '0'))\n      .join('');\n\n    const ivHex = Array.from(iv)\n      .map((b) => b.toString(16).padStart(2, '0'))\n      .join('');\n\n    return {\n      ciphertext,\n      iv: ivHex,\n      algorithm: 'AES-256-GCM',\n    };\n  }\n\n  /**\n   * è§£å¯†æ•°æ®ï¼ˆAES-256-GCMï¼‰\n   *\n   * @param payload åŠ å¯†æ•°æ®åŒ…\n   * @param encryptionKey åŠ å¯†å¯†é’¥\n   * @param parseJson æ˜¯å¦è‡ªåŠ¨è§£æ JSONï¼ˆé»˜è®¤ trueï¼‰\n   * @returns è§£å¯†åçš„æ˜æ–‡æ•°æ®\n   */\n  static async decrypt(\n    payload: EncryptedPayload,\n    encryptionKey: CryptoKey,\n    parseJson: boolean = true\n  ): Promise<any> {\n    // æ­¥éª¤ 1ï¼šå°† Hex ç¼–ç è½¬æ¢å› Uint8Array\n    const ciphertextBuffer = new Uint8Array(\n      payload.ciphertext.match(/.{2}/g)!.map((byte) => parseInt(byte, 16))\n    );\n\n    const iv = new Uint8Array(\n      payload.iv.match(/.{2}/g)!.map((byte) => parseInt(byte, 16))\n    );\n\n    // æ­¥éª¤ 2ï¼šä½¿ç”¨ AES-GCM è§£å¯†\n    try {\n      const plaintextBuffer = await crypto.subtle.decrypt(\n        {\n          name: 'AES-GCM',\n          iv: iv,\n          tagLength: GCM_TAG_LENGTH,\n        },\n        encryptionKey,\n        ciphertextBuffer\n      );\n\n      // æ­¥éª¤ 3ï¼šè½¬æ¢ä¸ºå­—ç¬¦ä¸²\n      const plaintextString = new TextDecoder().decode(plaintextBuffer);\n\n      // æ­¥éª¤ 4ï¼šå°è¯•è§£æ JSONï¼ˆå¦‚æœå¤±è´¥ï¼Œè¿”å›åŸå§‹å­—ç¬¦ä¸²ï¼‰\n      if (parseJson) {\n        try {\n          return JSON.parse(plaintextString);\n        } catch {\n          return plaintextString;\n        }\n      }\n\n      return plaintextString;\n    } catch (error) {\n      throw new Error('Decryption failed: Invalid key or corrupted data');\n    }\n  }\n\n  /**\n   * ç”Ÿæˆéšæœºç›ï¼ˆç”¨äºç”¨æˆ·æ³¨å†Œï¼‰\n   *\n   * @param length ç›çš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼Œé»˜è®¤ 32ï¼‰\n   * @returns Hex ç¼–ç çš„éšæœºç›\n   */\n  static generateSalt(length: number = 32): string {\n    const buffer = crypto.getRandomValues(new Uint8Array(length));\n    return Array.from(buffer)\n      .map((b) => b.toString(16).padStart(2, '0'))\n      .join('');\n  }\n\n  /**\n   * ç”Ÿæˆå¼ºéšæœºå¯†ç ï¼ˆç”¨äºå¯†ç ç®¡ç†å™¨ï¼‰\n   *\n   * @param length å¯†ç é•¿åº¦ï¼ˆé»˜è®¤ 16ï¼‰\n   * @param options å¯†ç é€‰é¡¹\n   * @returns éšæœºå¯†ç \n   */\n  static generatePassword(\n    length: number = 16,\n    options: {\n      uppercase?: boolean;\n      lowercase?: boolean;\n      digits?: boolean;\n      symbols?: boolean;\n    } = {}\n  ): string {\n    const {\n      uppercase = true,\n      lowercase = true,\n      digits = true,\n      symbols = true,\n    } = options;\n\n    const uppercaseChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n    const lowercaseChars = 'abcdefghijklmnopqrstuvwxyz';\n    const digitChars = '0123456789';\n    const symbolChars = '!@#$%^&*()_+-=[]{}|;:,.<>?';\n\n    let charset = '';\n    if (uppercase) charset += uppercaseChars;\n    if (lowercase) charset += lowercaseChars;\n    if (digits) charset += digitChars;\n    if (symbols) charset += symbolChars;\n\n    if (charset.length === 0) {\n      throw new Error('At least one character type must be enabled');\n    }\n\n    // ä½¿ç”¨åŠ å¯†å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå¯†ç \n    const randomValues = crypto.getRandomValues(new Uint32Array(length));\n    let password = '';\n\n    for (let i = 0; i < length; i++) {\n      const randomIndex = randomValues[i] % charset.length;\n      password += charset[randomIndex];\n    }\n\n    return password;\n  }\n\n  /**\n   * è®¡ç®—å¯†ç å¼ºåº¦ï¼ˆ0-100ï¼‰\n   *\n   * @param password å¾…è¯„ä¼°çš„å¯†ç \n   * @returns å¯†ç å¼ºåº¦åˆ†æ•°ï¼ˆ0-100ï¼‰\n   */\n  static calculatePasswordStrength(password: string): number {\n    // ğŸ” å¼ºåˆ¶è¦æ±‚ï¼šæœ€å°‘ 12 å­—ç¬¦ï¼Œæœ€å¤š 32 å­—ç¬¦\n    if (password.length < 12 || password.length > 32) {\n      return 0; // ä¸ç¬¦åˆé•¿åº¦è¦æ±‚ï¼Œç›´æ¥è¿”å› 0 åˆ†\n    }\n\n    let score = 0;\n\n    // é•¿åº¦åŠ åˆ†\n    if (password.length >= 12) score += 30; // 12å­—ç¬¦åŸºç¡€åˆ†\n    if (password.length >= 16) score += 10; // 16å­—ç¬¦é¢å¤–åˆ†\n\n    // å­—ç¬¦ç±»å‹åŠ åˆ†\n    if (/[a-z]/.test(password)) score += 15; // å°å†™å­—æ¯\n    if (/[A-Z]/.test(password)) score += 15; // å¤§å†™å­—æ¯\n    if (/\\d/.test(password)) score += 15;    // æ•°å­—\n    if (/[^a-zA-Z0-9]/.test(password)) score += 15; // ç‰¹æ®Šå­—ç¬¦\n\n    return Math.min(score, 100);\n  }\n\n  /**\n   * è®¡ç®—æ•°æ®çš„ SHA-256 å“ˆå¸Œï¼ˆç”¨äº checksumï¼‰\n   *\n   * @param data å¾…å“ˆå¸Œçš„æ•°æ®\n   * @returns Hex ç¼–ç çš„å“ˆå¸Œå€¼\n   */\n  static async hash(data: string): Promise<string> {\n    const buffer = new TextEncoder().encode(data);\n    const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);\n    return Array.from(new Uint8Array(hashBuffer))\n      .map((b) => b.toString(16).padStart(2, '0'))\n      .join('');\n  }\n}\n\n/**\n * å¯†ç ç­–ç•¥éªŒè¯\n */\nexport class PasswordPolicy {\n  static readonly MIN_LENGTH = 12;\n  static readonly MIN_STRENGTH = 60;\n\n  static validate(password: string): { valid: boolean; errors: string[] } {\n    const errors: string[] = [];\n\n    if (password.length < this.MIN_LENGTH) {\n      errors.push(`å¯†ç é•¿åº¦è‡³å°‘ ${this.MIN_LENGTH} ä¸ªå­—ç¬¦`);\n    }\n\n    if (!/[a-z]/.test(password)) {\n      errors.push('å¯†ç å¿…é¡»åŒ…å«å°å†™å­—æ¯');\n    }\n\n    if (!/[A-Z]/.test(password)) {\n      errors.push('å¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯');\n    }\n\n    if (!/\\d/.test(password)) {\n      errors.push('å¯†ç å¿…é¡»åŒ…å«æ•°å­—');\n    }\n\n    if (!/[^a-zA-Z0-9]/.test(password)) {\n      errors.push('å¯†ç å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦');\n    }\n\n    const strength = CryptoEngine.calculatePasswordStrength(password);\n    if (strength < this.MIN_STRENGTH) {\n      errors.push(`å¯†ç å¼ºåº¦ä¸è¶³ï¼ˆå½“å‰ï¼š${strength}/100ï¼Œè¦æ±‚ï¼š${this.MIN_STRENGTH}/100ï¼‰`);\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  }\n}\n","/**\n * åŠ å¯†å¼•æ“å°è£…\n * æä¾›ç®€åŒ–çš„åŠ å¯†/è§£å¯†æ¥å£\n */\n\nimport { CryptoEngine, type EncryptedPayload } from '@anynote/shared/crypto/crypto-engine';\n\n/**\n * åŠ å¯†å­˜å‚¨ç®¡ç†å™¨\n */\nexport class CryptoManager {\n  private encryptionKey: CryptoKey | null = null;\n\n  /**\n   * åˆå§‹åŒ–åŠ å¯†ç®¡ç†å™¨ï¼ˆæ³¨å†Œæ—¶ï¼‰\n   */\n  async initialize(masterPassword: string, email: string): Promise<{\n    salt: string;\n    authHash: string;\n  }> {\n    // ç”Ÿæˆéšæœºç›\n    const salt = CryptoEngine.generateSalt();\n\n    // æ´¾ç”Ÿå¯†é’¥\n    const { encryptionKey, authHash } = await CryptoEngine.deriveKeys(\n      masterPassword,\n      email,\n      salt\n    );\n\n    // ä¿å­˜åŠ å¯†å¯†é’¥åˆ°å†…å­˜\n    this.encryptionKey = encryptionKey;\n\n    // ä¿å­˜ç›å€¼åˆ° localStorage\n    localStorage.setItem(`anynote_salt_${email}`, salt);\n\n    return { salt, authHash };\n  }\n\n  /**\n   * ä»å·²æœ‰ç›å€¼æ¢å¤ï¼ˆç™»å½•æ—¶ï¼‰\n   */\n  async restore(masterPassword: string, email: string, salt: string): Promise<string> {\n    // æ´¾ç”Ÿå¯†é’¥\n    const { encryptionKey, authHash } = await CryptoEngine.deriveKeys(\n      masterPassword,\n      email,\n      salt\n    );\n\n    // ä¿å­˜åŠ å¯†å¯†é’¥åˆ°å†…å­˜\n    this.encryptionKey = encryptionKey;\n\n    return authHash;\n  }\n\n  /**\n   * è·å–ç›å€¼ï¼ˆä» localStorageï¼‰\n   */\n  getSalt(email: string): string | null {\n    return localStorage.getItem(`anynote_salt_${email}`);\n  }\n\n  /**\n   * æ¸…é™¤æ‰€æœ‰åŠ å¯†æ•°æ®\n   */\n  clear() {\n    this.encryptionKey = null;\n  }\n\n  /**\n   * åŠ å¯†æ•°æ®\n   */\n  async encrypt(data: any): Promise<EncryptedPayload> {\n    if (!this.encryptionKey) {\n      throw new Error('åŠ å¯†å¯†é’¥æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆç™»å½•');\n    }\n\n    return CryptoEngine.encrypt(data, this.encryptionKey);\n  }\n\n  /**\n   * è§£å¯†æ•°æ®\n   */\n  async decrypt(payload: EncryptedPayload, parseJson = true): Promise<any> {\n    if (!this.encryptionKey) {\n      throw new Error('åŠ å¯†å¯†é’¥æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆç™»å½•');\n    }\n\n    return CryptoEngine.decrypt(payload, this.encryptionKey, parseJson);\n  }\n\n  /**\n   * ç”Ÿæˆéšæœºå¯†ç \n   */\n  generatePassword(length = 16, options?: {\n    uppercase?: boolean;\n    lowercase?: boolean;\n    digits?: boolean;\n    symbols?: boolean;\n  }): string {\n    return CryptoEngine.generatePassword(length, options || {\n      uppercase: true,\n      lowercase: true,\n      digits: true,\n      symbols: true,\n    });\n  }\n\n  /**\n   * è®¡ç®—å¯†ç å¼ºåº¦\n   */\n  calculatePasswordStrength(password: string): number {\n    return CryptoEngine.calculatePasswordStrength(password);\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–\n   */\n  isInitialized(): boolean {\n    return this.encryptionKey !== null;\n  }\n\n  /**\n   * è·å–åŠ å¯†å¯†é’¥ï¼ˆç”¨äºæŒä¹…åŒ–å­˜å‚¨ï¼‰\n   */\n  getEncryptionKey(): CryptoKey | null {\n    return this.encryptionKey;\n  }\n\n  /**\n   * è®¾ç½®åŠ å¯†å¯†é’¥ï¼ˆç”¨äºä»æŒä¹…åŒ–å­˜å‚¨æ¢å¤ï¼‰\n   */\n  setEncryptionKey(key: CryptoKey): void {\n    this.encryptionKey = key;\n  }\n}\n\n// å…¨å±€å•ä¾‹\nexport const crypto = new CryptoManager();\n"],"names":["CryptoEngine","masterPassword","email","salt","passwordKey","combinedSalt","encryptionKey","authSalt","authBits","authHash","b","plaintext","plaintextString","plaintextBuffer","iv","ciphertextBuffer","ciphertext","ivHex","payload","parseJson","byte","length","buffer","options","uppercase","lowercase","digits","symbols","uppercaseChars","lowercaseChars","digitChars","symbolChars","charset","randomValues","password","i","randomIndex","score","data","hashBuffer","CryptoManager","__publicField","key","crypto"],"mappings":"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"}